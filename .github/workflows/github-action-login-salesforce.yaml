#create workflow for salesforce login
name: Login salesforce to test

#workflow triggerd by push request
on: [push]

jobs:
  my_first_jobs:
    runs-on: ubuntu-latest
    steps: 
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Salesforce CLI
        run: |
          curl https://developer.salesforce.com/media/salesforce-cli/sfdx-linux-amd64.tar.xz --output sfdx.tar.xz
          mkdir sfdx
          tar xJf sfdx.tar.xz -C sfdx --strip-components 1
          sudo ./sfdx/install
          
#      - name: Authenticate with Salesforce CLI
#         run: |
#         #sfdx force:auth:web:login --setalias MyOrgAlias --instanceurl https://login.salesforce.com --setdefaultusername


#old salesforce version
#https://developer.salesforce.com/docs/atlas.en-us.sfdx_cli_reference.meta/sfdx_cli_reference/cli_reference_auth_web.htm
#      - name: Authenticate with Salesforce CLI
#        run: |
#         sfdx force:auth:web:login --setalias MyOrgAlias --instanceurl https://login.salesforce.com -u ${{ secrets.SALESFORCE_USERNAME }} -p ${{ secrets.SALESFORCE_PASSWORD }}


#new salesforce version
#https://developer.salesforce.com/docs/atlas.en-us.sfdx_cli_reference.meta/sfdx_cli_reference/cli_reference_auth_web.htm
#      - name: Authenticate with Salesforce CLI
#        run: |
#          sfdx auth:web:login --alias MyOrgAlias -r https://login.salesforce.com -s

      - name: Authenticate with Salesforce CLI
        run: |
          echo ${{ secrets.SALESFORCE_CONSUMER_KEY }} | sfdx force:auth:jwt:grant --clientid ${{ secrets.SALESFORCE_CONSUMER_KEY }} --jwtkeyfile ${{ secrets.SALESFORCE_SERVER_KEY }} -u ${{ secrets.SALESFORCE_USERNAME }} --setdefaultdevhubusername --setdefaultusername -p ${{ secrets.SALESFORCE_PASSWORD }}